---
description: コードレビュー→修正ループを自動実行
---

このコマンドは、Git差分のレビューと修正を自動化します。以下の処理を実行してください：

# 処理フロー

## 1. 変更ファイルの特定

Bash ツールで以下のコマンドを実行し、変更ファイルを特定：

```bash
git status --porcelain | awk '{print $2}' | sort -u
```

変更がない場合は「変更ファイルがありません」と報告して終了。

## 2. レビューループ（最大5回）

以下を繰り返す（最大5回まで）：

### 2.1 reviewer エージェントの起動

Task ツールで reviewer エージェントを起動：

```
Task(
  subagent_type="review-loop-plugin:reviewer",
  description="コードレビュー実行",
  prompt="以下のファイルをレビューしてください:\n- file1.js\n- file2.js\n\n各ファイルを Read ツールで読み込み、重要度付き（高・中・低）の指摘を出力してください。"
)
```

**重要:** ファイルリストは必ず明示的に列挙すること。

### 2.2 レビュー結果のパース

reviewer の出力から最後の集計行を抽出：

- `重要度「高」: X件`
- `重要度「中」: Y件`
- `重要度「低」: Z件`

**終了条件:** 重要度の高い直すべき点が 0 件ならループ終了。

### 2.3 指摘の修正
修正が必要だと判断するべき内容があれば修正を実施して、修正内容を記録

### 2.4 無限ループの防止
- 最大5回の反復で強制終了

## 3. リンター修正

Bash ツールでリンターを実行：

### TypeScript/JavaScript の場合
```bash
npx eslint . --fix
```

### Python の場合
```bash
ruff check . --fix
```

リンターが存在しない場合はスキップ。

## 4. 完了報告

以下の情報を報告：
- レビューループの反復回数
- 全ての修正した指摘（重要度別）
- リンターで修正した内容
- 最終的な状態

# 重要な注意事項

## エラーハンドリング
- Git コマンドが失敗した場合は終了
- reviewer エージェントがエラーを返した場合は再試行（最大2回）
- リンターが存在しない場合はスキップ
