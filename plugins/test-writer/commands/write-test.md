以下の手順、原則に従い、テスト設計原則に従い、モックを最小限に抑え、実際の依存関係を使用してテストを書くことで、システムの真の動作を検証します。

## 手順

**テスト作成手順:**
1. 最初にテスト計画書を作成する（テスト計画書はmarkdownファイルでテストフォルダ直下に置く）
2. 一旦作業をやめて、「test-plan-reviewer」に計画書のレビューをしてもらうように依頼する。また、レビュー後はまた呼び出して貰うように伝える。改善点がなくなるまで「計画書を書き直してレビューをもらう作業」を繰り返す。
3. 計画書に従ってテストを作成して、テストがエラーなく通るまでテストの修正を行う
4. 一旦作業をやめて、「test-reviewer」にテストのレビューをしてもらうように依頼する。また、レビュー後はまた呼び出して貰うように伝える。改善点がなくなるまで「テストを書き直してレビューをもらう作業」を繰り返す。
5. 終了

## 必ず従う原則

**テスト設計原則:**
- 統合テスト（シナリオテスト）はモジュールや関数のようなコードに対してではなく、プロジェクトで達成しようとしている仕様に対して書く
- 統合テストから仕様が理解できるようにする
- 単体テストは純粋なドメインロジックだけを行い、IOに対するテストはなるべく統合テスト（シナリオテスト）に組み込む
- 仕様に関係しない、内部実装の詳細に対するテストは行わない

**テスト構造:**
1. **Arrange（準備）**: テストデータと前提条件を明確に設定
2. **Act（実行）**: テスト対象の処理を実行
3. **Assert（検証）**: 期待される結果を検証
- Assertでは内部実装は確認しない
- 詳細を変更しても壊れないAssertにする

**命名規則:**
- 日本語を用いる
- テストメソッド名は「系：確認対象の仕様」の形式（系には正常系 or 異常系を書き入れる）

**品質基準:**
- テストの意図が明確で、他の開発者が読んで理解できる
- テストデータは意味のある値を使用（magic numberを避ける）
- Assertでは詳細までは確認せず、出入り口の値や処理のみ確認する

## モックについて

**モック:**
- モックは外部システム（API、データベース、ファイルシステム）との境界でのみ使用する
- 内部の依存関係やドメインオブジェクトはモックしない
- 複数箇所で使用するモックは一箇所にまとまっている

**モック使用の判断基準:**
- 外部API呼び出し: モック使用
- データベースアクセス: テスト用DBまたはモック
- ファイルI/O: モック使用
- 内部サービスクラス: 実際のインスタンス使用
- ドメインオブジェクト: 実際のインスタンス使用

テストコードを通じて、システムの仕様書としての役割も果たすよう、可読性と保守性を最優先に設計してください。YAGNI原則に従い、必要最小限のテストコードで最大の価値を提供します。
